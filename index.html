<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø´Ø±ÙƒØ© Ø§Ù„ÙÙ‡Ø¯ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø©</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #1c1e21;
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --border: #e4e6eb;
        }

        [data-theme="dark"] {
            --bg-color: #18191a;
            --card-bg: #242526;
            --text-color: #e4e6eb;
            --primary: #ffffff;
            --border: #3e4042;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; background-color: var(--bg-color);
            color: var(--text-color); transition: 0.3s;
            padding-bottom: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ù„Ù„ÙƒÙˆÙ…Ø¨ÙŠÙˆØªØ± ÙÙ‚Ø·) */
        .sidebar {
            width: 240px; background: var(--primary); color: white;
            position: fixed; height: 100%; right: 0; top: 0; z-index: 1000;
        }

        .sidebar-header { padding: 25px; text-align: center; font-size: 1.4rem; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-menu { list-style: none; padding: 0; margin: 0; }
        .sidebar-menu li {
            padding: 18px 25px; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; gap: 12px; font-size: 1.1rem;
        }
        .sidebar-menu li:hover, .sidebar-menu li.active { background: var(--accent); }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© (Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙÙ‚Ø·) */
        .mobile-nav {
            display: none; position: fixed; bottom: 0; width: 100%;
            background: var(--card-bg); border-top: 1px solid var(--border);
            justify-content: space-around; padding: 10px 0; z-index: 2000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        .mobile-nav-item { text-align: center; font-size: 0.8rem; color: var(--text-color); cursor: pointer; flex: 1; }
        .mobile-nav-item.active { color: var(--accent); font-weight: bold; }
        .mobile-nav-item span { display: block; font-size: 1.5rem; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-content { margin-right: 240px; padding: 20px; max-width: 1000px; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--card-bg); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid var(--border); }
        .stat-card h4 { margin: 0; font-size: 0.9rem; opacity: 0.7; }
        .stat-card p { font-size: 1.2rem; font-weight: bold; margin: 5px 0 0; color: var(--accent); }

        .search-box {
            width: 100%; padding: 15px; margin-bottom: 20px; border-radius: 10px;
            border: 1px solid var(--border); background: var(--card-bg); color: var(--text-color);
            font-size: 1rem; outline: none;
        }

        .card { background: var(--card-bg); padding: 20px; border-radius: 15px; border: 1px solid var(--border); margin-bottom: 15px; }
        .page { display: none; }
        .page.active { display: block; }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-color); color: var(--text-color); }
        button { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-main { background: var(--accent); color: white; width: 100%; }
        
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--bg-color); padding: 12px; text-align: right; }
        td { padding: 15px; border-bottom: 1px solid var(--border); }

        /* ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„ÙƒØ±ÙˆØª ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .mobile-nav { display: flex; }
            .main-content { margin-right: 0; padding: 15px; }
            
            table thead { display: none; }
            table tr { display: block; background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 10px; padding: 10px; }
            table td { display: flex; justify-content: space-between; align-items: center; border: none; padding: 8px 5px; }
            table td::before { content: attr(data-label); font-weight: bold; color: var(--accent); }
            
            .btn-theme { display: none; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .stat-card:first-child { grid-column: span 2; }
        }

        /* Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
        #invoice-print { display: none; }
        @media print {
            body * { visibility: hidden; }
            #invoice-print, #invoice-print * { visibility: visible; }
            #invoice-print { display: block; position: absolute; left: 0; top: 0; width: 100%; padding: 20px; }
        }
    </style>
</head>
<body>

    <button class="btn-theme" onclick="toggleTheme()" style="position:fixed; left:20px; top:20px; z-index:3000;">ğŸŒ“</button>

    <nav class="sidebar">
        <div class="sidebar-header">Ø´Ø±ÙƒØ© Ø§Ù„ÙÙ‡Ø¯ ğŸ†</div>
        <ul class="sidebar-menu">
            <li class="active" onclick="showPage('addPage', this)"><span>â•</span> Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ†</li>
            <li onclick="showPage('listPage', this)"><span>ğŸ“‹</span> Ø§Ù„Ø¯ÙŠÙˆÙ†</li>
            <li onclick="showPage('historyPage', this)"><span>ğŸ§¾</span> Ø§Ù„ÙÙˆØ§ØªÙŠØ±</li>
            <li onclick="showPage('settingsPage', this)"><span>âš™ï¸</span> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</li>
        </ul>
    </nav>

    <nav class="mobile-nav">
        <div class="mobile-nav-item active" onclick="showPage('addPage', this)"><span>â•</span>Ø¥Ø¶Ø§ÙØ©</div>
        <div class="mobile-nav-item" onclick="showPage('listPage', this)"><span>ğŸ“‹</span>Ø§Ù„Ø¯ÙŠÙˆÙ†</div>
        <div class="mobile-nav-item" onclick="showPage('historyPage', this)"><span>ğŸ§¾</span>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</div>
        <div class="mobile-nav-item" onclick="showPage('settingsPage', this)"><span>âš™ï¸</span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
    </nav>

    <main class="main-content">
        <div class="stats-grid">
            <div class="stat-card"><h4>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</h4><p id="stat-remaining">0</p></div>
            <div class="stat-card"><h4>Ø§Ù„Ù…Ø³ØªÙ„Ù…</h4><p id="stat-paid">0</p></div>
            <div class="stat-card"><h4>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙ†ÙŠÙ†</h4><p id="stat-count">0</p></div>
        </div>

        <section id="addPage" class="page active">
            <div class="card">
                <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯</h3>
                <input type="text" id="debtorName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ (Ù…Ø«Ù„Ø§Ù‹: Ø£Ø¨Ùˆ Ø£Ø­Ù…Ø¯)">
                <input type="number" id="debtAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                <button class="btn-main" onclick="addDebt()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </section>

        <section id="listPage" class="page">
            <input type="text" class="search-box" id="searchDebts" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù…..." onkeyup="filterDebts()">
            <div id="debtContainer">
                <table>
                    <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                    <tbody id="debtTableBody"></tbody>
                </table>
            </div>
        </section>

        <section id="historyPage" class="page">
            <div id="historyContainer">
                <table>
                    <thead><tr><th>Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead>
                    <tbody id="historyTableBody"></tbody>
                </table>
            </div>
        </section>

        <section id="settingsPage" class="page">
            <div class="card">
                <h3>Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ù†Ø³Ø®</h3>
                <button class="btn-main" style="background:#8e44ad; margin-bottom:10px" onclick="exportData()">ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                <button class="btn-main" style="background:#7f8c8d; margin-bottom:10px" onclick="document.getElementById('importFile').click()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <input type="file" id="importFile" style="display:none" onchange="importData(event)">
                <button class="btn-main" onclick="toggleTheme()">ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ (Ù„ÙŠÙ„/Ù†Ù‡Ø§Ø±)</button>
                <button class="btn-main" style="background:var(--danger); margin-top:30px" onclick="resetAllData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
            </div>
        </section>
    </main>

    <div id="invoice-print">
        <h1 style="text-align:center">Ø´Ø±ÙƒØ© Ø§Ù„ÙÙ‡Ø¯</h1>
        <hr>
        <p>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span id="inv-id"></span></p>
        <p>Ø§Ù„Ø§Ø³Ù…: <span id="inv-name"></span></p>
        <p>Ø§Ù„Ù…Ø¨Ù„Øº: <span id="inv-amount"></span></p>
        <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="inv-date"></span></p>
        <h2 style="text-align:center; color:green">ØªÙ… Ø§Ù„ØªØ³Ø¯ÙŠØ¯</h2>
    </div>

    <script>
        let debts = JSON.parse(localStorage.getItem('fhd_debts')) || [];
        let history = JSON.parse(localStorage.getItem('fhd_history')) || [];
        let theme = localStorage.getItem('fhd_theme') || 'light';

        document.documentElement.setAttribute('data-theme', theme);

        function toggleTheme() {
            theme = theme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('fhd_theme', theme);
        }

        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„ÙƒÙˆÙ…Ø¨ÙŠÙˆØªØ± ÙˆØ§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
            document.querySelectorAll('.sidebar-menu li, .mobile-nav-item').forEach(li => li.classList.remove('active'));
            
            // Ø±Ø¨Ø· Ø§Ù„Ø¶ØºØ· Ø¨ÙŠÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…ØªÙŠÙ†
            const index = Array.from(el.parentNode.children).indexOf(el);
            document.querySelectorAll('.sidebar-menu li')[index].classList.add('active');
            document.querySelectorAll('.mobile-nav-item')[index].classList.add('active');
            
            render();
            updateStats();
        }

        function filterDebts() {
            const query = document.getElementById('searchDebts').value.toLowerCase();
            const rows = document.querySelectorAll('#debtTableBody tr');
            rows.forEach(row => {
                const name = row.cells[0].innerText.toLowerCase();
                row.style.display = name.includes(query) ? '' : 'none';
            });
        }

        function addDebt() {
            const name = document.getElementById('debtorName').value;
            const amount = parseFloat(document.getElementById('debtAmount').value);
            if (name && amount > 0) {
                debts.push({ id: Date.now(), name, amount });
                save();
                document.getElementById('debtorName').value = '';
                document.getElementById('debtAmount').value = '';
                alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
            }
        }

        function pay(id, isFull) {
            const item = debts.find(d => d.id === id);
            let val = item.amount;
            if(!isFull) {
                val = parseFloat(prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³Ø¯Ø¯:"));
                if(!val || val > item.amount) return;
            }
            history.push({ invId: "F-"+Math.floor(Math.random()*1000), name: item.name, amount: val, date: new Date().toLocaleDateString('ar-EG') });
            item.amount -= val;
            if(item.amount <= 0) debts = debts.filter(d => d.id !== id);
            save();
        }

        function render() {
            document.getElementById('debtTableBody').innerHTML = debts.map(d => `
                <tr>
                    <td data-label="Ø§Ù„Ø§Ø³Ù…">${d.name}</td>
                    <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº" style="color:var(--danger); font-weight:bold;">${d.amount.toLocaleString()}</td>
                    <td data-label="Ø¥Ø¬Ø±Ø§Ø¡">
                        <button style="background:var(--success); color:white; padding:5px 10px;" onclick="pay(${d.id}, true)">ÙƒØ§Ù…Ù„</button>
                        <button style="background:var(--warning); color:white; padding:5px 10px; margin-right:5px;" onclick="pay(${d.id}, false)">Ø¬Ø²Ø¡</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('historyTableBody').innerHTML = history.slice().reverse().map((h, i) => `
                <tr>
                    <td data-label="Ø§Ù„ÙØ§ØªÙˆØ±Ø©">${h.invId}</td>
                    <td data-label="Ø§Ù„Ø§Ø³Ù…">${h.name}</td>
                    <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº" style="color:var(--success)">${h.amount.toLocaleString()}</td>
                    <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${h.date}</td>
                </tr>
            `).join('');
        }

        function updateStats() {
            const rem = debts.reduce((s, d) => s + d.amount, 0);
            const paid = history.reduce((s, h) => s + h.amount, 0);
            document.getElementById('stat-remaining').innerText = rem.toLocaleString();
            document.getElementById('stat-paid').innerText = paid.toLocaleString();
            document.getElementById('stat-count').innerText = debts.length;
        }

        function save() {
            localStorage.setItem('fhd_debts', JSON.stringify(debts));
            localStorage.setItem('fhd_history', JSON.stringify(history));
            render(); updateStats();
        }

        function exportData() {
            const blob = new Blob([JSON.stringify({debts, history})], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = "fahad_debts.json";
            a.click();
        }

        function importData(e) {
            const reader = new FileReader();
            reader.onload = (ev) => {
                const data = JSON.parse(ev.target.result);
                debts = data.debts; history = data.history;
                save(); alert("ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­");
            };
            reader.readAsText(e.target.files[0]);
        }

        function resetAllData() {
            if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹!")) {
                debts = []; history = []; save();
            }
        }

        updateStats(); render();
    </script>
</body>
</html>
