<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø´Ø±ÙƒØ© Ø§Ù„ÙÙ‡Ø¯ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙŠÙˆÙ†</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/552/552791.png">

    <style>
        :root {
            --bg-color: #f0f2f5; --card-bg: #ffffff; --text-color: #1c1e21;
            --primary: #2c3e50; --accent: #3498db; --success: #27ae60;
            --danger: #e74c3c; --border: #e4e6eb;
        }
        [data-theme="dark"] {
            --bg-color: #18191a; --card-bg: #242526; --text-color: #e4e6eb;
            --primary: #ffffff; --border: #3e4042;
        }
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; 
            background: var(--bg-color); color: var(--text-color); transition: 0.3s;
            padding-bottom: 70px;
        }

        /*Sidebar for PC*/
        .sidebar {
            width: 240px; background: var(--primary); color: white;
            position: fixed; height: 100%; right: 0; top: 0; z-index: 1000;
        }
        .sidebar-header { padding: 25px; text-align: center; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-menu { list-style: none; padding: 0; }
        .sidebar-menu li { padding: 18px 25px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .sidebar-menu li:hover, .sidebar-menu li.active { background: var(--accent); }

        /*Bottom Nav for Mobile*/
        .mobile-nav {
            display: none; position: fixed; bottom: 0; width: 100%;
            background: var(--card-bg); border-top: 1px solid var(--border);
            justify-content: space-around; padding: 10px 0; z-index: 2000;
        }
        .nav-item { text-align: center; font-size: 0.75rem; flex: 1; cursor: pointer; color: var(--text-color); opacity: 0.6; }
        .nav-item.active { opacity: 1; color: var(--accent); font-weight: bold; }
        .nav-item span { display: block; font-size: 1.4rem; }

        .main-content { margin-right: 240px; padding: 20px; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--card-bg); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid var(--border); }
        .stat-card p { font-size: 1.3rem; font-weight: bold; margin: 5px 0 0; color: var(--accent); }

        .search-box { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-color); box-sizing: border-box; }
        .card { background: var(--card-bg); padding: 20px; border-radius: 15px; border: 1px solid var(--border); margin-bottom: 15px; }
        
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-color); color: var(--text-color); box-sizing: border-box; }
        button { padding: 12px 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-main { background: var(--accent); color: white; width: 100%; }

        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid var(--border); }

        @media (max-width: 768px) {
            .sidebar { display: none; }
            .mobile-nav { display: flex; }
            .main-content { margin-right: 0; }
            table thead { display: none; }
            table tr { display: block; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 10px; padding: 10px; }
            table td { display: flex; justify-content: space-between; border: none; padding: 8px 5px; }
            table td::before { content: attr(data-label); font-weight: bold; color: var(--accent); }
        }

        #invoice-print { display: none; }
        @media print {
            body * { visibility: hidden; }
            #invoice-print, #invoice-print * { visibility: visible; }
            #invoice-print { display: block; position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="sidebar-header">Ø´Ø±ÙƒØ© Ø§Ù„ÙÙ‡Ø¯ ğŸ†</div>
        <ul class="sidebar-menu">
            <li class="active" onclick="showPage('addPage', this)"><span>â•</span> Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ†</li>
            <li onclick="showPage('listPage', this)"><span>ğŸ“‹</span> Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù†Ø´Ø·Ø©</li>
            <li onclick="showPage('historyPage', this)"><span>ğŸ§¾</span> Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</li>
            <li onclick="showPage('settingsPage', this)"><span>âš™ï¸</span> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</li>
        </ul>
    </nav>

    <nav class="mobile-nav">
        <div class="nav-item active" onclick="showPage('addPage', this)"><span>â•</span>Ø¥Ø¶Ø§ÙØ©</div>
        <div class="nav-item" onclick="showPage('listPage', this)"><span>ğŸ“‹</span>Ø§Ù„Ø¯ÙŠÙˆÙ†</div>
        <div class="nav-item" onclick="showPage('historyPage', this)"><span>ğŸ§¾</span>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</div>
        <div class="nav-item" onclick="showPage('settingsPage', this)"><span>âš™ï¸</span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
    </nav>

    <main class="main-content">
        <div class="stats-grid">
            <div class="stat-card"><h4>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</h4><p id="stat-rem">0</p></div>
            <div class="stat-card"><h4>Ø§Ù„Ù…Ø³ØªÙ„Ù…</h4><p id="stat-paid">0</p></div>
        </div>

        <section id="addPage" class="page active">
            <div class="card">
                <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯</h3>
                <input type="text" id="debtName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†">
                <input type="number" id="debtAmt" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                <button class="btn-main" onclick="addDebt()">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
            </div>
        </section>

        <section id="listPage" class="page">
            <input type="text" class="search-box" id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ..." onkeyup="filter()">
            <div class="card">
                <table>
                    <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                    <tbody id="debtTable"></tbody>
                </table>
            </div>
        </section>

        <section id="historyPage" class="page">
            <div class="card">
                <table>
                    <thead><tr><th>Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead>
                    <tbody id="histTable"></tbody>
                </table>
            </div>
        </section>

        <section id="settingsPage" class="page">
            <div class="card">
                <button class="btn-main" onclick="exportData()" style="background:#8e44ad">ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                <button class="btn-main" onclick="document.getElementById('fileIn').click()" style="background:#7f8c8d; margin-top:10px;">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <input type="file" id="fileIn" style="display:none" onchange="importData(event)">
                <button class="btn-main" onclick="toggleTheme()" style="margin-top:10px; background:#555">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… ğŸŒ“</button>
                <button class="btn-main" onclick="resetAll()" style="background:var(--danger); margin-top:30px">ğŸ—‘ï¸ ØªØµÙÙŠØ± ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </section>
    </main>

    <div id="invoice-print">
        <h1 style="text-align:center">Ø´Ø±ÙƒØ© Ø§Ù„ÙÙ‡Ø¯</h1>
        <hr>
        <p>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span id="p-id"></span></p>
        <p>Ø§Ù„Ø§Ø³Ù…: <span id="p-name"></span></p>
        <p>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³Ø¯Ø¯: <span id="p-amt"></span></p>
        <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="p-date"></span></p>
        <h2 style="text-align:center; color:green">âœ” ØªÙ… Ø§Ù„ØªØ³Ø¯ÙŠØ¯</h2>
    </div>

    <script>
        let debts = JSON.parse(localStorage.getItem('f_debts')) || [];
        let history = JSON.parse(localStorage.getItem('f_hist')) || [];
        let theme = localStorage.getItem('f_theme') || 'light';
        document.documentElement.setAttribute('data-theme', theme);

        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item, .sidebar-menu li').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            render(); updateStats();
        }

        function addDebt() {
            const n = document.getElementById('debtName').value;
            const a = parseFloat(document.getElementById('debtAmt').value);
            if(n && a > 0) {
                debts.push({id: Date.now(), name: n, amount: a});
                document.getElementById('debtName').value = '';
                document.getElementById('debtAmt').value = '';
                save(); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
            }
        }

        function pay(id, isFull) {
            const item = debts.find(d => d.id === id);
            let val = item.amount;
            if(!isFull) {
                val = parseFloat(prompt(`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø­Ø§Ù„ÙŠ ${item.amount}. Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³Ø¯Ø¯:`));
                if(!val || val > item.amount) return;
            }
            history.push({invId: "INV-"+Math.floor(Math.random()*9000), name: item.name, amount: val, date: new Date().toLocaleString('ar-EG')});
            item.amount -= val;
            if(item.amount <= 0) debts = debts.filter(d => d.id !== id);
            save();
        }

        function filter() {
            const q = document.getElementById('search').value.toLowerCase();
            const rows = document.querySelectorAll('#debtTable tr');
            rows.forEach(r => r.style.display = r.cells[0].innerText.toLowerCase().includes(q) ? '' : 'none');
        }

        function render() {
            document.getElementById('debtTable').innerHTML = debts.map(d => `
                <tr><td data-label="Ø§Ù„Ø§Ø³Ù…">${d.name}</td><td data-label="Ø§Ù„Ù…Ø¨Ù„Øº">${d.amount.toLocaleString()}</td>
                <td data-label="Ø¥Ø¬Ø±Ø§Ø¡"><button onclick="pay(${d.id}, true)" style="background:var(--success); color:white">ÙƒØ§Ù…Ù„</button>
                <button onclick="pay(${d.id}, false)" style="background:var(--warning); color:white">Ø¬Ø²Ø¡</button></td></tr>`).join('');
            
            document.getElementById('histTable').innerHTML = history.slice().reverse().map((h, i) => `
                <tr><td data-label="Ø§Ù„ÙØ§ØªÙˆØ±Ø©">${h.invId}</td><td data-label="Ø§Ù„Ø§Ø³Ù…">${h.name}</td>
                <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº">${h.amount.toLocaleString()}</td><td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${h.date}</td></tr>`).join('');
        }

        function updateStats() {
            const r = debts.reduce((s, d) => s + d.amount, 0);
            const p = history.reduce((s, h) => s + h.amount, 0);
            document.getElementById('stat-rem').innerText = r.toLocaleString();
            document.getElementById('stat-paid').innerText = p.toLocaleString();
        }

        function save() {
            localStorage.setItem('f_debts', JSON.stringify(debts));
            localStorage.setItem('f_hist', JSON.stringify(history));
            render(); updateStats();
        }

        function toggleTheme() {
            theme = (theme === 'light') ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('f_theme', theme);
        }

        function exportData() {
            const blob = new Blob([JSON.stringify({debts, history})], {type: 'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
            a.download = "fahad_backup.json"; a.click();
        }

        function importData(e) {
            const reader = new FileReader();
            reader.onload = (ev) => {
                const data = JSON.parse(ev.target.result);
                debts = data.debts; history = data.history;
                save(); alert("ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­");
            };
            reader.readAsText(e.target.files[0]);
        }

        function resetAll() { if(confirm("ØªØµÙÙŠØ± ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) { debts=[]; history=[]; save(); } }

        render(); updateStats();
    </script>
</body>
</html>
