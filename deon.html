<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø´Ø±ÙƒØ© Ø§Ù„ÙÙ‡Ø¯ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    <style>
        :root {
            --sidebar-width: 250px;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333;
            --sidebar-bg: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --border: #ddd;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --sidebar-bg: #111;
            --border: #444;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; display: flex; background-color: var(--bg-color);
            color: var(--text-color); min-height: 100vh; transition: 0.3s;
        }

        .sidebar { width: var(--sidebar-width); background: var(--sidebar-bg); color: white; position: fixed; height: 100%; z-index: 1000; }
        .sidebar-header { padding: 20px; text-align: center; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-menu { list-style: none; padding: 0; margin: 20px 0; }
        .sidebar-menu li { padding: 15px 20px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .sidebar-menu li:hover, .sidebar-menu li.active { background: var(--accent); }

        .main-content { margin-right: var(--sidebar-width); flex: 1; padding: 30px; transition: 0.3s; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .stat-card p { font-size: 1.5rem; font-weight: bold; margin: 10px 0 0; }

        .search-box {
            width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px;
            border: 1px solid var(--border); background: var(--card-bg); color: var(--text-color);
            font-size: 1rem; box-sizing: border-box;
        }

        .card { background: var(--card-bg); padding: 25px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 20px; }
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        input { width: 100%; padding: 12px; margin-top: 5px; margin-bottom: 15px; border: 1px solid var(--border); border-radius: 8px; background: var(--card-bg); color: var(--text-color); box-sizing: border-box; }
        button { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        
        .btn-main { background: var(--accent); color: white; width: 100%; }
        .btn-reset { background: var(--danger); color: white; width: 100%; margin-top: 20px; }
        .btn-theme { position: fixed; top: 20px; left: 20px; z-index: 2000; background: var(--sidebar-bg); color: white; }

        table { width: 100%; border-collapse: collapse; background: var(--card-bg); }
        th, td { padding: 15px; text-align: right; border-bottom: 1px solid var(--border); }

        #invoice-print { display: none; }

        @media print {
            body * { visibility: hidden; }
            #invoice-print, #invoice-print * { visibility: visible; }
            #invoice-print { display: block; position: absolute; left: 0; top: 0; width: 100%; padding: 40px; color: black !important; background: white !important; }
        }

        @media (max-width: 768px) {
            .sidebar { width: 60px; }
            .menu-text, .sidebar-header { display: none; }
            .main-content { margin-right: 60px; }
        }
    </style>
</head>
<body>

    <button class="btn-theme" onclick="toggleTheme()">ğŸŒ“ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ…</button>

    <nav class="sidebar">
        <div class="sidebar-header">Ø´Ø±ÙƒØ© Ø§Ù„ÙÙ‡Ø¯ ğŸ†</div>
        <ul class="sidebar-menu">
            <li class="active" onclick="showPage('addPage', this)"><span>â•</span><span class="menu-text">Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ†</span></li>
            <li onclick="showPage('listPage', this)"><span>ğŸ“‹</span><span class="menu-text">Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù†Ø´Ø·Ø©</span></li>
            <li onclick="showPage('historyPage', this)"><span>ğŸ§¾</span><span class="menu-text">Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</span></li>
            <li onclick="showPage('settingsPage', this)"><span>âš™ï¸</span><span class="menu-text">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></li>
        </ul>
    </nav>

    <main class="main-content">
        <div class="stats-grid">
            <div class="stat-card" style="border-top: 4px solid var(--accent)"><h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†</h4><p id="stat-total-ever">0</p></div>
            <div class="stat-card" style="border-top: 4px solid var(--danger)"><h4>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</h4><p id="stat-remaining">0</p></div>
            <div class="stat-card" style="border-top: 4px solid var(--success)"><h4>Ø§Ù„Ù…Ø³ØªÙ„Ù…</h4><p id="stat-paid">0</p></div>
        </div>

        <section id="addPage" class="page active">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯</h2>
            <div class="card" style="max-width: 500px; margin: auto;">
                <label>Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ</label>
                <input type="text" id="debtorName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                <label>Ø§Ù„Ù…Ø¨Ù„Øº</label>
                <input type="number" id="debtAmount" placeholder="0.00">
                <button class="btn-main" onclick="addDebt()">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
            </div>
        </section>

        <section id="listPage" class="page">
            <h2>Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
            <input type="text" class="search-box" id="searchDebts" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ Ù‡Ù†Ø§..." onkeyup="filterDebts()">
            <div class="card">
                <table>
                    <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                    <tbody id="debtTableBody"></tbody>
                </table>
            </div>
        </section>

        <section id="historyPage" class="page">
            <h2>Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h2>
            <div class="card">
                <table>
                    <thead><tr><th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø·Ø¨Ø§Ø¹Ø©</th></tr></thead>
                    <tbody id="historyTableBody"></tbody>
                </table>
            </div>
        </section>

        <section id="settingsPage" class="page">
            <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„ØªØ­ÙƒÙ…</h2>
            <div class="card" style="max-width: 600px; margin: auto;">
                <h3>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
                <button class="btn-main" style="background:#8e44ad;" onclick="exportData()">ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© (JSON)</button>
                <input type="file" id="importFile" style="display:none" onchange="importData(event)">
                <button class="btn-main" style="background:#7f8c8d; margin-top:10px;" onclick="document.getElementById('importFile').click()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù</button>
                
                <hr style="margin: 30px 0;">
                
                <h3 style="color: var(--danger);">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</h3>
                <p style="font-size: 0.9rem; color: #777;">Ø³ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ø¥Ù„Ù‰ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ.</p>
                <button class="btn-reset" onclick="resetAllData()">ğŸ—‘ï¸ ØªØµÙÙŠØ± ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Reset)</button>
            </div>
        </section>
    </main>

    <div id="invoice-print">
        <div style="text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px;">
            <h1>Ø´Ø±ÙƒØ© Ø§Ù„ÙÙ‡Ø¯ Ù„Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h1>
            <p>Ø³Ù†Ø¯ Ù‚Ø¨Ø¶ / ÙØ§ØªÙˆØ±Ø© ØªØ³Ø¯ÙŠØ¯ Ø¯ÙŠÙ†</p>
        </div>
        <div style="margin-top: 30px; font-size: 1.2rem; line-height: 2;">
            <p><strong>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</strong> <span id="inv-id"></span></p>
            <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> <span id="inv-date"></span></p>
            <hr>
            <p>ÙˆØµÙ„Ù†Ø§ Ù…Ù† Ø§Ù„Ø³ÙŠØ¯: <strong id="inv-name"></strong></p>
            <p>Ù…Ø¨Ù„Øº ÙˆÙ‚Ø¯Ø±Ù‡: <strong id="inv-amount"></strong></p>
            <h2 style="text-align: center; color: green; margin-top: 50px;">âœ” ØªÙ… Ø§Ù„ØªØ³Ø¯ÙŠØ¯</h2>
        </div>
    </div>

    <script>
        let debts = JSON.parse(localStorage.getItem('fhd_debts')) || [];
        let history = JSON.parse(localStorage.getItem('fhd_history')) || [];
        let theme = localStorage.getItem('fhd_theme') || 'light';

        document.documentElement.setAttribute('data-theme', theme);

        function toggleTheme() {
            theme = theme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('fhd_theme', theme);
        }

        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.sidebar-menu li').forEach(li => li.classList.remove('active'));
            el.classList.add('active');
            updateStats();
            render();
        }

        function filterDebts() {
            const query = document.getElementById('searchDebts').value.toLowerCase();
            const rows = document.querySelectorAll('#debtTableBody tr');
            rows.forEach(row => {
                const name = row.cells[0].innerText.toLowerCase();
                row.style.display = name.includes(query) ? '' : 'none';
            });
        }

        function addDebt() {
            const name = document.getElementById('debtorName').value;
            const amount = parseFloat(document.getElementById('debtAmount').value);
            if (name && amount > 0) {
                debts.push({ id: Date.now(), name, amount });
                saveAndRender();
                document.getElementById('debtorName').value = '';
                document.getElementById('debtAmount').value = '';
                alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­");
            }
        }

        function pay(id, isFull) {
            const item = debts.find(d => d.id === id);
            let amountToPay = item.amount;
            if (!isFull) {
                const partial = parseFloat(prompt(`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø­Ø§Ù„ÙŠ ${item.amount}. Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³Ø¯Ø¯:`));
                if (isNaN(partial) || partial <= 0 || partial > item.amount) return;
                amountToPay = partial;
            }
            const invoiceId = "INV-" + Math.floor(Math.random() * 90000 + 10000);
            history.push({ invId: invoiceId, name: item.name, amount: amountToPay, date: new Date().toLocaleString('ar-EG') });
            item.amount -= amountToPay;
            if (item.amount <= 0) debts = debts.filter(d => d.id !== id);
            saveAndRender();
        }

        function resetAllData() {
            const confirm1 = confirm("âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ");
            if (confirm1) {
                const confirm2 = confirm("â— Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ÙØ¹Ù„Ø§Ù‹ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙ„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§!");
                if (confirm2) {
                    debts = [];
                    history = [];
                    saveAndRender();
                    alert("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­.");
                }
            }
        }

        function printInvoice(index) {
            const data = history.slice().reverse()[index];
            document.getElementById('inv-id').innerText = data.invId;
            document.getElementById('inv-name').innerText = data.name;
            document.getElementById('inv-amount').innerText = data.amount.toLocaleString() + " Ø¯.Ø¹";
            document.getElementById('inv-date').innerText = data.date;
            window.print();
        }

        function updateStats() {
            const remaining = debts.reduce((sum, d) => sum + d.amount, 0);
            const paid = history.reduce((sum, h) => sum + h.amount, 0);
            document.getElementById('stat-remaining').innerText = remaining.toLocaleString();
            document.getElementById('stat-paid').innerText = paid.toLocaleString();
            document.getElementById('stat-total-ever').innerText = (remaining + paid).toLocaleString();
        }

        function saveAndRender() {
            localStorage.setItem('fhd_debts', JSON.stringify(debts));
            localStorage.setItem('fhd_history', JSON.stringify(history));
            render();
            updateStats();
        }

        function render() {
            document.getElementById('debtTableBody').innerHTML = debts.map(d => `
                <tr><td>${d.name}</td><td style="color:var(--danger); font-weight:bold;">${d.amount.toLocaleString()}</td>
                <td><button style="background:var(--success); color:white" onclick="pay(${d.id}, true)">ÙƒØ§Ù…Ù„</button>
                <button style="background:var(--warning); color:white" onclick="pay(${d.id}, false)">Ø¬Ø²Ø¡</button></td></tr>
            `).join('');

            document.getElementById('historyTableBody').innerHTML = history.slice().reverse().map((h, index) => `
                <tr><td>${h.invId}</td><td>${h.name}</td><td style="color:var(--success); font-weight:bold;">${h.amount.toLocaleString()}</td>
                <td style="font-size:12px">${h.date}</td><td><button onclick="printInvoice(${index})">ğŸ–¨ï¸</button></td></tr>
            `).join('');
        }

        function exportData() {
            const blob = new Blob([JSON.stringify({debts, history})], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `fahad_company_backup.json`;
            a.click();
        }

        function importData(e) {
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    debts = data.debts || [];
                    history = data.history || [];
                    saveAndRender();
                    alert("ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…");
                } catch(err) {
                    alert("ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­ âŒ");
                }
            };
            reader.readAsText(e.target.files[0]);
        }
        
        render(); updateStats();
    </script>
</body>
</html>
